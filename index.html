Вот обновлённый HTML-код с новыми функциями:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Рыболовная игра</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .panel {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .inventory {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .fish-item {
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 5px;
            background-color: #f9f9f9;
            min-width: 80px;
            text-align: center;
        }
        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 10px;
        }
        .progress {
            height: 20px;
            border-radius: 5px;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.1s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .upgrade {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .fish-common { color: black; }
        .fish-copper { color: #b87333; }
        .fish-silver { color: #c0c0c0; }
        .fish-gold { color: #ffd700; }
        .fish-platinum { color: #e5e4e2; }
        .resource-wood { color: #8B4513; }
        .resource-stone { color: #808080; }
        .resource-iron { color: #A19D94; }
        .resource-diamond { color: #b9f2ff; }
        .resource-hellstone { color: #ff4500; }
        .resource-lightstone { color: #ffff99; text-shadow: 0 0 2px #000; }
        .resource-megaore { color: #ff00ff; text-shadow: 0 0 2px #000; }
        .resource-ultraore { color: #00ffff; text-shadow: 0 0 2px #000; }
        .resource-lightdust { color: #ffffff; text-shadow: 0 0 2px #000; }
        .resource-darkdust { color: #333333; text-shadow: 0 0 2px #fff; }
        .resource-angelore { color: #ffccff; text-shadow: 0 0 2px #000; }
        .resource-fishingore { color: #66ccff; text-shadow: 0 0 2px #000; }
        .resource-angelingot { color: #ffccff; font-weight: bold; }
        .resource-hellingot { color: #ff4500; font-weight: bold; }
        .resource-yinyang { color: #000; background: linear-gradient(to right, #fff 50%, #000 50%); font-weight: bold; }
        .shop-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #2196F3;
        }
        .highlight {
            animation: highlight 1s;
        }
        @keyframes highlight {
            0% { background-color: #ffff00; }
            100% { background-color: #f0f0f0; }
        }
        .bait {
            background-color: #ffeb3b;
        }
        .battle-info {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #ffebee;
        }
        .mining-active {
            background-color: #4CAF50;
            color: white;
        }
        .timer {
            font-weight: bold;
            margin-top: 5px;
        }
        .quest {
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .house {
            background-color: #fff8e1;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h1>Рыболовная игра</h1>
            <div class="stats">
                <div>Деньги: $<span id="money">0</span></div>
                <div>Инвентарь: <span id="inventory-count">0</span>/<span id="inventory-max">5</span></div>
                <div>Время ловли: <span id="fishing-time">10</span> сек</div>
                <div>Время продажи: <span id="sell-time">5</span> сек</div>
                <div>Удача: <span id="luck">0</span>%</div>
                <div>Приманка: <span id="active-bait">Нет</span></div>
                <div>Пассивный доход: $<span id="passive-income">0</span>/3 сек</div>
            </div>
        </div>

        <div class="panel">
            <h2>Рыбалка</h2>
            <button id="fish-button">Ловить рыбу</button>
            <div class="progress-bar" id="progress-container" style="display: none;">
                <div class="progress" id="progress-bar"></div>
            </div>
            <div id="fishing-result"></div>
        </div>

        <div class="panel">
            <h2>Майнинг</h2>
            <button id="start-mining-button">Начать майнинг (100$)</button>
            <div id="mining-info" style="display: none; margin-top: 10px;">
                <p>Осталось времени: <span id="mining-time">60</span> сек</p>
                <button id="mine-button">Добыть пыль</button>
                <div class="timer" id="mining-timer"></div>
            </div>
            <div>Светлая пыль: <span id="lightdust-count">0</span></div>
            <div>Тёмная пыль: <span id="darkdust-count">0</span></div>
            <div>Ангельская руда: <span id="angelore-count">0</span></div>
            <div>Рыболовная руда: <span id="fishingore-count">0</span></div>
        </div>

        <div class="panel">
            <h2>Квесты</h2>
            <div id="quest-container" class="quest">
                <p id="quest-text">Квестов пока нет</p>
                <p id="quest-progress"></p>
                <p id="quest-reward"></p>
            </div>
            <div id="quest-timer" class="timer" style="display: none;">Новый квест через: <span id="quest-time">60</span> сек</div>
        </div>

        <div class="panel">
            <h2>Инвентарь</h2>
            <button id="sell-button" disabled>Продать всю рыбу</button>
            <div class="progress-bar" id="sell-progress-container" style="display: none; margin-top: 10px;">
                <div class="progress" id="sell-progress-bar"></div>
            </div>
            <div class="inventory" id="inventory"></div>
        </div>

        <div class="panel">
            <h2>Дом</h2>
            <div id="house-info" class="house">
                <p>Домов построено: <span id="house-count">0</span></p>
                <button id="build-house-button">Построить дом (25 дерева и 10 камней)</button>
            </div>
        </div>

        <div class="panel">
            <button id="shop-toggle" class="shop-toggle">Магазин улучшений</button>
            <div id="shop-content" style="display: none;">
                <h2>Магазин улучшений</h2>
                <div class="upgrade">
                    <div>
                        <h3>Уменьшить время ловли</h3>
                        <p>Текущее время: <span id="current-fishing-time">10</span> сек</p>
                    </div>
                    <button id="upgrade-time-button">Купить за $<span id="upgrade-time-cost">5</span></button>
                </div>
                <div class="upgrade">
                    <div>
                        <h3>Увеличить инвентарь</h3>
                        <p>Текущий размер: <span id="current-inventory-size">5</span></p>
                    </div>
                    <button id="upgrade-inventory-button">Купить за $<span id="upgrade-inventory-cost">10</span></button>
                </div>
                <div class="upgrade">
                    <div>
                        <h3>Уменьшить время продажи (5 → 3 сек)</h3>
                        <p>Текущее время: <span id="current-sell-time">5</span> сек</p>
                    </div>
                    <button id="upgrade-sell-time-button-1">Купить за $20</button>
                </div>
                <div class="upgrade">
                    <div>
                        <h3>Уменьшить время продажи (3 → 1 сек)</h3>
                    </div>
                    <button id="upgrade-sell-time-button-2">Купить за $40</button>
                </div>
                <div class="upgrade">
                    <div>
                        <h3>Мгновенная продажа (1 → 0 сек)</h3>
                    </div>
                    <button id="upgrade-sell-time-button-3">Купить за $60</button>
                </div>
            </div>
        </div>

        <div class="panel">
            <button id="craft-toggle" class="shop-toggle">Ресурсы и удочки</button>
            <div id="craft-content" style="display: none;">
                <h2>Ресурсы и удочки</h2>
                <button id="get-resource-button">Ловить ресурсы (5$)</button>
                <div>Дерево: <span id="wood-count">0</span></div>
                <div>Камень: <span id="stone-count">0</span></div>
                <div>Железо: <span id="iron-count">0</span></div>
                <div>Алмаз: <span id="diamond-count">0</span></div>
                <div>Адский камень: <span id="hellstone-count">0</span></div>
                <div>Светлый камень: <span id="lightstone-count">0</span></div>
                <div>Мега руда: <span id="megaore-count">0</span></div>
                <div>Ультра руда: <span id="ultraore-count">0</span></div>
                <div>Ангельский слиток: <span id="angelingot-count">0</span></div>
                <div>Адский слиток: <span id="hellingot-count">0</span></div>
                <div>Инь и Янь: <span id="yinyang-count">0</span></div>
                
                <div class="upgrade" id="wooden-rod">
                    <div>
                        <h3>Деревянная удочка</h3>
                        <p>+0.1% к удаче (кроме обычной рыбы, дерева и камня)</p>
                        <p>Требуется: 10 дерева</p>
                    </div>
                    <button id="craft-wooden-rod-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="stone-rod">
                    <div>
                        <h3>Каменная удочка</h3>
                        <p>+0.25% к удаче (кроме обычной рыбы, дерева и камня)</p>
                        <p>Требуется: 5 камней</p>
                    </div>
                    <button id="craft-stone-rod-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="iron-rod">
                    <div>
                        <h3>Железная удочка</h3>
                        <p>+0.5% к удаче (кроме обычной рыбы, дерева и камня)</p>
                        <p>Требуется: 3 железа</p>
                    </div>
                    <button id="craft-iron-rod-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="durable-rod">
                    <div>
                        <h3>Прочная удочка</h3>
                        <p>+0.75% к удаче (кроме обычной рыбы, дерева и камня)</p>
                        <p>Требуется: 2 алмаза и 1 железо</p>
                    </div>
                    <button id="craft-durable-rod-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="hell-rod">
                    <div>
                        <h3>Адская удочка</h3>
                        <p>+1% к удаче (кроме обычной рыбы, дерева и камня)</p>
                        <p>Требуется: 3 адских камня</p>
                    </div>
                    <button id="craft-hell-rod-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="mega-rod">
                    <div>
                        <h3>Мега удочка</h3>
                        <p>+2% к удаче (кроме дерева, камня, железа, рыбы, медной рыбы)</p>
                        <p>Требуется: 1 светлый камень и 1 мега руда</p>
                    </div>
                    <button id="craft-mega-rod-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="angel-rod">
                    <div>
                        <h3>Ангельская удочка</h3>
                        <p>+7% к удаче (кроме железа) -777% к дереву, камню и рыбе</p>
                        <p>Требуется: 3 ангельской руды</p>
                    </div>
                    <button id="craft-angel-rod-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="master-luck">
                    <div>
                        <h3>Удача мастера</h3>
                        <p>+25% к удаче (только для мега руды и рыболовной руды)</p>
                        <p>Требуется: 2 рыболовной руды</p>
                    </div>
                    <button id="craft-master-luck-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="angelingot">
                    <div>
                        <h3>Ангельский слиток</h3>
                        <p>Требуется: 10 светлой пыли, 1 камень, 2 алмаза</p>
                    </div>
                    <button id="craft-angelingot-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="hellingot">
                    <div>
                        <h3>Адский слиток</h3>
                        <p>Требуется: 10 тёмной пыли, 2 камня, 4 железа</p>
                    </div>
                    <button id="craft-hellingot-button" disabled>Создать</button>
                </div>
                
                <div class="upgrade" id="yinyang">
                    <div>
                        <h3>Инь и Янь (приманка)</h3>
                        <p>+100% к удаче для мега руды (одноразовая)</p>
                        <p>Требуется: 1 ангельский слиток и 1 адский слиток</p>
                    </div>
                    <button id="craft-yinyang-button" disabled>Создать</button>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>Приманки</h2>
            <div class="upgrade bait" id="stone-sandwich">
                <div>
                    <h3>Бутерброд с камнем</h3>
                    <p>+3% к удаче (кроме дерева и камня)</p>
                    <p>Требуется: 3 дерева и 3 камня</p>
                </div>
                <button id="craft-stone-sandwich-button" disabled>Создать</button>
            </div>
            <div class="upgrade bait" id="hell-bait">
                <div>
                    <h3>Адская приманка</h3>
                    <p>+10% к удаче (кроме дерева, камня, рыбы, медной и серебряной рыбы, железа)</p>
                    <p>Требуется: 5 железа, 1 алмаз и 1 адский камень</p>
                </div>
                <button id="craft-hell-bait-button" disabled>Создать</button>
            </div>
        </div>

        <div class="panel">
            <h2>Битва с бомжом</h2>
            <button id="start-battle-button">Начать битву (бесплатно)</button>
            <div id="battle-info" class="battle-info" style="display: none;">
                <p>Бомж: <span id="bomj-health">20</span>/20 HP</p>
                <button id="hit-bomj-button">Ударить бомжа</button>
            </div>
        </div>
    </div>

    <script>
        // Игровые переменные
        let money = 0;
        let inventory = [];
        let inventoryMax = 5;
        let fishingTime = 10;
        let sellTime = 5;
        let fishingProgress = 0;
        let fishingInterval = null;
        let sellInterval = null;
        let luck = 0;
        let wood = 0;
        let stone = 0;
        let iron = 0;
        let diamond = 0;
        let hellstone = 0;
        let lightstone = 0;
        let megaore = 0;
        let ultraore = 0;
        let lightdust = 0;
        let darkdust = 0;
        let angelore = 0;
        let fishingore = 0;
        let angelingot = 0;
        let hellingot = 0;
        let yinyang = 0;
        let upgradeTimeCost = 5;
        let upgradeInventoryCost = 10;
        let activeBait = null;
        let bomjHealth = 20;
        let miningActive = false;
        let miningTimeLeft = 0;
        let miningTimer = null;
        let houses = 0;
        let passiveIncomeInterval = null;
        let currentQuest = null;
        let questProgress = 0;
        let questTimer = null;
        let questTimeLeft = 60;
        let rods = {
            wooden: false,
            stone: false,
            iron: false,
            durable: false,
            hell: false,
            mega: false,
            angel: false,
            master: false
        };

        // Квесты
        const
            
